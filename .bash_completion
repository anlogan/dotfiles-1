#!/bin/bash

# git-commit override
_git_commit() {
  local cur ng_set

  # do nothing if we're not in a repo
  git rev-parse 2>/dev/null || return 0

  _get_comp_words_by_ref cur

  # complete uncommitted files
  if [[ ${COMP_WORDS[1]} = "commit" ]]; then
    COMPREPLY=( $(compgen -W "$( git status -s | cut -d' ' -f3-)" -- $cur ) )
  fi
}

# aurcomm
_aurcomm() {
  local cur
  _get_comp_words_by_ref cur

  (( ${#cur} < 2 )) && return

  COMPREPLY=( $(compgen -W "$(cower -sq -- $cur)" -- $cur) )
}
complete -F _aurcomm aurcomm

_ghclone() {
  local cur
  _get_comp_words_by_ref cur

  COMPREPLY=( $(compgen -W "$(
    curl --compressed -sf "http://github.com/api/v2/json/repos/show/${COMP_WORDS[1]}" |
    json_reformat 2>/dev/null |
    sed -n '/"name":/s|.*: "\([^"]\+\)",|\1|p')" -- $cur)
  )
}
complete -F _ghclone ghclone

# pacman wrappers
complete -o filenames -F _pacman pp pm

# go
complete -f -X '!*.8' 8l
complete -f -X '!*.6' 6l
complete -f -X '!*.5' 5l
complete -f -X '!*.go' 8g 6g 5g gofmt gccgo

